<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harry Undersand â€” DÃ©veloppeur & Architecte IA</title>

<!-- Open Graph (WhatsApp, Facebook, Telegram, Discord) -->
<meta property="og:title" content="Harry Undersand â€” DÃ©veloppeur & Architecte IA">
<meta property="og:description" content="Chatbots IA, Streaming Premium, HÃ©bergement Cloud et solutions digitales modernes.">
<meta property="og:image" content="https://files.catbox.moe/7p2g2y.jpg">
<meta property="og:url" content="https://harry-undersand.vercel.app">
<meta property="og:type" content="website">

<!-- Twitter / X -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Harry Undersand â€” DÃ©veloppeur & Architecte IA">
<meta name="twitter:description" content="Chatbots IA, Streaming Premium, HÃ©bergement Cloud et automatisation digitale.">
<meta name="twitter:image" content="https://files.catbox.moe/7p2g2y.jpg">

<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>â›©ï¸</text></svg>">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0b141a;
--card:#111b21;
--border:rgba(139,92,246,.35);
--violet:#8b5cf6;
--violet-dark:#7c3aed;
--text:#e9edef;
--muted:#8696a0;
}
body{
font-family:Inter,Arial,sans-serif;
background:var(--bg);
color:var(--text);
}
header{
position:fixed;
top:0;width:100%;
z-index:1000;
background:rgba(11,20,26,.9);
backdrop-filter:blur(16px);
border-bottom:1px solid var(--border);
}
.navbar{
max-width:1200px;
margin:auto;
padding:16px 24px;
display:flex;
justify-content:space-between;
align-items:center;
}
.logo{color:var(--violet);font-weight:800;text-decoration:none}
.nav-links{display:flex;gap:18px}
.nav-links a{color:var(--muted);text-decoration:none}
.nav-links a:hover{color:var(--violet)}
.burger{display:none;font-size:22px;cursor:pointer}

.container{max-width:1200px;margin:auto;padding:20px}
.hero{padding-top:160px;text-align:center}
.hero h1{font-size:3rem}
.hero span{color:var(--violet)}
.hero p{margin:20px auto;max-width:780px;color:var(--muted)}
.btn{padding:12px 22px;border-radius:30px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:linear-gradient(135deg,var(--violet),var(--violet-dark));color:#fff}
.btn-outline{background:none;border:1px solid var(--border);color:#fff}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:28px;margin-top:40px}
.card{
background:var(--card);
border:1px solid var(--border);
border-radius:20px;
padding:26px;
transition:.3s;
}
.card:hover{transform:translateY(-6px);box-shadow:0 0 30px rgba(139,92,246,.35)}

.auth-actions{display:flex;gap:10px;align-items:center}
.auth-actions img{width:32px;height:32px;border-radius:50%}

.modal-bg{
position:fixed;inset:0;
background:rgba(0,0,0,.65);
display:none;
align-items:center;
justify-content:center;
z-index:2000
}
.modal{
background:var(--card);
border:1px solid var(--border);
padding:30px;
border-radius:20px;
max-width:420px;width:100%
}
.auth-btn{
width:100%;
padding:14px;
margin-top:12px;
border-radius:12px;
border:none;
cursor:pointer;
font-weight:600;
display:flex;
align-items:center;
justify-content:center;
gap:10px
}
.auth-btn.google{background:#fff;color:#000}
.auth-btn.facebook{background:#1877f2;color:#fff}
.auth-btn.github{background:#0f172a;color:#fff}
.close-btn{margin-top:16px;background:none;border:none;color:#94a3b8;cursor:pointer}

.stars-display{
  margin:6px 0 10px;
  color:#facc15;
}

/* =========================
   â­ AVIS & COMMENTAIRES
========================= */

#comments{
max-width:900px;
margin:80px auto;
padding:40px;
background:linear-gradient(180deg,#0f172a,#020617);
border:1px solid var(--border);
border-radius:26px;
box-shadow:0 0 60px rgba(139,92,246,.25);
}

#comments h2{
text-align:center;
font-size:2.2rem;
margin-bottom:25px;
background:linear-gradient(135deg,var(--violet),#a78bfa);
-webkit-background-clip:text;
color:transparent;
}

/* FORM */
#comment-form{
display:flex;
flex-direction:column;
gap:16px;
background:rgba(255,255,255,.02);
padding:30px;
border-radius:20px;
border:1px solid rgba(255,255,255,.06);
}

#comment-form input,
#comment-form textarea{
background:#020617;
border:1px solid rgba(255,255,255,.08);
border-radius:14px;
padding:14px 16px;
color:#fff;
font-size:15px;
outline:none;
}

#comment-form textarea{
min-height:120px;
resize:none;
}

#comment-form input:focus,
#comment-form textarea:focus{
border-color:var(--violet);
box-shadow:0 0 0 2px rgba(139,92,246,.35);
}

/* â­ Ã‰TOILES */
.stars{
display:flex;
justify-content:center;
gap:10px;
font-size:32px;
cursor:pointer;
}

.stars span{
filter:grayscale(1);
opacity:.4;
transition:.25s ease;
}

.stars span:hover,
.stars span.active{
filter:none;
opacity:1;
transform:scale(1.25);
text-shadow:0 0 14px rgba(250,204,21,.7);
}

/* BOUTON */
#comment-form button{
margin-top:10px;
align-self:center;
padding:14px 34px;
border-radius:40px;
border:none;
font-weight:700;
font-size:15px;
cursor:pointer;
color:white;
background:linear-gradient(135deg,var(--violet),var(--violet-dark));
box-shadow:0 0 30px rgba(139,92,246,.45);
transition:.3s;
}

#comment-form button:hover{
transform:translateY(-2px);
box-shadow:0 0 50px rgba(139,92,246,.65);
}

/* ğŸ“Š STATS */
#comments > p{
text-align:center;
margin:25px 0 35px;
font-size:1.1rem;
color:#c4b5fd;
}

/* LISTE COMMENTAIRES */
#comments-list{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:22px;
}

/* CARTE COMMENTAIRE */
.comment-card{
background:rgba(255,255,255,.03);
border:1px solid rgba(255,255,255,.08);
border-radius:20px;
padding:22px;
transition:.3s;
position:relative;
overflow:hidden;
}

.comment-card::before{
content:"";
position:absolute;
inset:0;
background:linear-gradient(120deg,transparent,rgba(139,92,246,.18),transparent);
opacity:0;
transition:.4s;
}

.comment-card:hover::before{
opacity:1;
}

.comment-card:hover{
transform:translateY(-6px);
box-shadow:0 0 40px rgba(139,92,246,.35);
}

.comment-card h4{
margin-bottom:6px;
color:#a78bfa;
}

.comment-card p{
color:#e5e7eb;
font-size:14px;
line-height:1.6;
}

.comment-card .stars-display{
margin:6px 0 10px;
color:#facc15;
}

.comment-date{
display:block;
margin-top:10px;
font-size:12px;
color:#9ca3af;
text-align:right;
}

.delete-comment{
margin-top:10px;
padding:6px 14px;
border:none;
border-radius:10px;
font-size:12px;
cursor:pointer;
background:#dc2626;
color:white;
}
.delete-comment:hover{
background:#b91c1c;
}

@media (max-width: 600px) {

  .hero h1 {
    font-size: 2rem;
  }

  .hero p {
    font-size: 1rem;
    padding: 0 10px;
  }

  .navbar {
    padding: 14px;
  }

  .auth-actions {
    flex-direction: column;
    gap: 6px;
  }

  #comments {
    margin: 40px 12px;
    padding: 24px 16px;
  }

  #comment-form {
    padding: 20px;
  }

  .stars {
    font-size: 26px;
  }

  .comment-card {
    padding: 18px;
  }

  .modal {
    margin: 0 12px;
  }
}

/* =========================
   ğŸ§  SECTION DESCRIPTION
========================= */
.about{
  max-width:1200px;
  margin:100px auto;
  padding:40px 20px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:50px;
  align-items:center;
}

.about h2{
  font-size:2.4rem;
  margin-bottom:20px;
  background:linear-gradient(135deg,var(--violet),#a78bfa);
  -webkit-background-clip:text;
  color:transparent;
}

.about p{
  color:var(--muted);
  font-size:1.05rem;
  line-height:1.8;
  margin-bottom:16px;
}

.about ul{
  margin-top:20px;
  padding-left:20px;
}

.about li{
  margin-bottom:10px;
  color:#e5e7eb;
}

.about img{
  width:100%;
  border-radius:22px;
  border:1px solid var(--border);
  box-shadow:0 0 60px rgba(139,92,246,.35);
}

@media(max-width:900px){
  .about{
    grid-template-columns:1fr;
    text-align:center;
  }
}

/* =========================
   ğŸ§© CARTES SERVICES
========================= */
.services{
  max-width:1200px;
  margin:80px auto;
  padding:0 20px;
}

.services h2{
  text-align:center;
  font-size:2.4rem;
  margin-bottom:50px;
  background:linear-gradient(135deg,var(--violet),#a78bfa);
  -webkit-background-clip:text;
  color:transparent;
}

.services-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:28px;
}

.service-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:22px;
  padding:30px;
  transition:.35s ease;
  opacity:0;
  transform:translateY(30px);
}

.service-card i{
  font-size:36px;
  color:var(--violet);
  margin-bottom:18px;
}

.service-card h3{
  margin-bottom:12px;
}

.service-card p{
  color:var(--muted);
  line-height:1.6;
}

.service-card.show{
  opacity:1;
  transform:translateY(0);
}

.service-card:hover{
  transform:translateY(-6px);
  box-shadow:0 0 40px rgba(139,92,246,.35);
}

.menu-btn{
  font-size:24px;
  cursor:pointer;
  color:var(--text);
  z-index:3001;
}

.drawer-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(10px);
  opacity:0;
  pointer-events:none;
  transition:.35s ease;
  z-index:1999;
}

.drawer-overlay.show{
  opacity:1;
  pointer-events:auto;
}

.drawer{
  position:fixed;
  top:0;
  right:-0;
  transform:translateX(100%);
  opacity:0;
  width:340px;
  max-width:90%;
  height:100vh;
  background:var(--card);
  border-left:1px solid var(--border);
  padding:28px;
  transition:
    transform .45s cubic-bezier(.4,0,.2,1),
    opacity .3s ease;
  z-index:2000;
  display:flex;
  flex-direction:column;
  }

.drawer.open{
  transform:translateX(0);
  opacity:1;
}

.drawer-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
  margin-bottom:30px;
}

.drawer-header button{
  background:none;
  border:none;
  color:var(--muted);
  font-size:20px;
  cursor:pointer;
}

.drawer-links a{
  display:block;
  padding:14px 12px;
  margin-bottom:6px;
  border-radius:14px;
  color:var(--muted);
  text-decoration:none;
  font-weight:500;
  opacity:0;
  transform:translateX(20px);
  animation:linkFade .4s forwards;
  touch-action:manipulation;
}

.drawer.open .drawer-links a{
  animation-delay:calc(var(--i) * 80ms);
}

.drawer-links a:hover{
  background:rgba(139,92,246,.15);
  color:var(--violet);
  position:relative;
}

.drawer-links{
  flex:1;
  overflow-y:auto;
  padding-right:6px;
  -webkit-overflow-scrolling: touch;
}

.drawer-links::after{
  content:"";
  position:sticky;
  bottom:0;
  left:0;
  width:100%;
  height:24px;
  pointer-events:none;
  background:linear-gradient(
    to bottom,
    rgba(15,15,25,0),
    rgba(15,15,25,.85)
  );
  opacity:0;
  transition:.3s;
}

.drawer-links.can-scroll::after{
  opacity:1;
}

.drawer-links::-webkit-scrollbar{
  width:6px;
}
.drawer-links::-webkit-scrollbar-thumb{
  background:rgba(139,92,246,.4);
  border-radius:10px;
}
.drawer-links::-webkit-scrollbar-track{
  background:transparent;
}

.drawer-cta{
  background:linear-gradient(135deg,var(--violet),var(--violet-dark));
  color:#fff !important;
  text-align:center;
  font-weight:700;
}

.drawer-search{
  margin-bottom:16px;
}

.drawer-search input{
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  background:var(--bg);
  border:1px solid var(--border);
  color:var(--text);
  outline:none;
}

.drawer-search input::placeholder{
  color:var(--muted);
}

@keyframes linkFade{
  to{
    opacity:1;
    transform:translateX(0);
  }
}

.drawer-links mark{
  background:rgba(139,92,246,.3);
  color:inherit;
  padding:2px 4px;
  border-radius:4px;
}
</style>
</head>

<body>

<header>
<section class="container" id="adminPanel" style="display:none">
  <div class="card">
    <h2>ğŸ‘‘ Administration</h2>

    <p>ğŸ“Š Visites : <b><span id="adminVisits">0</span></b></p>

    <h3>ğŸ‘¥ Utilisateurs</h3>
    <table class="users-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>RÃ´le</th>
          <th>Statut</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="usersTable"></tbody>
    </table>
  </div>
</section>

<div class="navbar">
<a class="logo" href="/">å½¡ã€ğ€ğ¦ğšğ­ğğ®ğ« ğƒğ ğ…ğšğ§ğ­ğšğ¢ğ¬ğ¢ğ ã€å½¡</a>
<div class="menu-btn" onclick="openDrawer()">
  <i class="fas fa-bars"></i>
</div>
<div class="auth-actions" id="authGuest">
<button class="btn btn-outline" id="loginBtn">Connexion</button>
<button class="btn btn-primary" id="registerBtn">Inscription</button>
</div>
<div class="auth-actions" id="authUser" style="display:none">
<span id="welcomeText"></span>
<img id="userPhoto">
<button class="btn btn-outline" id="logoutBtn">DÃ©connexion</button>
</div>
</div>
</header>

<div class="drawer-overlay" onclick="closeDrawer()"></div>

<aside class="drawer" id="drawerMenu">
  <div class="drawer-header">
    <span>Navigation</span>
    <button onclick="closeDrawer()">âœ•</button>
  </div>
  
<div class="drawer-search">
  <input type="text" id="drawerSearch" placeholder="Rechercher...">
</div>

<nav class="drawer-links">
  <a href="harry-undersand.html" style="--i:1">ğŸ‘¤ Harry Undersand</a>
  <a href="chatbot.html" style="--i:1">ğŸ¤– Chatbots IA</a>
  <a href="streaming.html" style="--i:2">ğŸ¬ Streaming</a>
  <a href="hosting.html" style="--i:3">â˜ï¸ HÃ©bergement</a>
  <a href="premium.html" style="--i:4">ğŸ’ Premium</a>
  <a href="services.html" style="--i:5">ğŸ§© Services</a>
  <a href="pack-streaming.html" style="--i:6">ğŸ Pack Streaming</a>
  <a href="about.html" style=--i--i:7">ğŸ’¡ A Propos</a>
  <a href="alice.html" style="--i:6">ğŸ—£ï¸ Alice</a>
  <a href="chat.html" style="--i:7">ğŸš€ MÃ©ssagerie</a>

  <hr>

  <a href="commande.html" class="drawer-cta" style="--i:8">ğŸ›’ Commander ğŸ›ï¸</a>
  <a href="contact.html" style="--i:9">ğŸ“ Contact â˜ï¸</a>
  <a href="amateurbox.html" class="drawer-cta" style="--i:10">ğŸ’° Amateur Box ğŸ’³</a>
  <a href="jeunetransitaire.html" style="--i:11">âš–ï¸ Jeune Transitaire Officiel âš“</a>

</nav>
</aside>

<section class="hero">
<h1>Harry Undersand<br><span>DÃ©veloppeur & Architecte IA</span></h1>
<p>Chatbots IA, Streaming Premium, HÃ©bergement Cloud et automatisation digitale.</p>
</section>

</section>

<!-- ğŸ§© SERVICES -->
<section class="services">
  <h2>Mes services</h2>

  <div class="services-grid">

    <div class="service-card">
      <i class="fas fa-robot"></i>
      <h3>Chatbots IA</h3>
      <p>
        Conception de chatbots intelligents capables de dialoguer,
        automatiser le support client et amÃ©liorer lâ€™expÃ©rience utilisateur.
      </p>
    </div>

    <div class="service-card">
      <i class="fas fa-cloud"></i>
      <h3>HÃ©bergement Cloud</h3>
      <p>
        Infrastructure sÃ©curisÃ©e, rapide et scalable pour vos
        applications web et plateformes professionnelles.
      </p>
    </div>

    <div class="service-card">
      <i class="fas fa-video"></i>
      <h3>Streaming Premium</h3>
      <p>
        DÃ©veloppement de plateformes de streaming modernes,
        optimisÃ©es pour la performance et la confidentialitÃ©.
      </p>
    </div>

    <div class="service-card">
      <i class="fas fa-gears"></i>
      <h3>Automatisation</h3>
      <p>
        Automatisation de processus mÃ©tier pour gagner du temps,
        rÃ©duire les erreurs et amÃ©liorer la productivitÃ©.
      </p>
    </div>

  </div>
</section>

<section class="container" style="text-align:center;margin-top:40px">
  <p style="color:#c4b5fd;font-size:1.1rem">
    ğŸ“… Aujourdâ€™hui : <b><span id="todayVisits">0</span></b>
  </p>
</section>

<!-- MODALE AUTH -->
<div class="modal-bg" id="authModal">
<div class="modal">
<h2>Connexion</h2>
<p>Choisis un moyen pour continuer</p>
<button class="auth-btn google" id="googleLogin"><i class="fab fa-google"></i> Google</button>
<button class="auth-btn facebook" id="facebookLogin"><i class="fab fa-facebook"></i> Facebook</button>
<button class="auth-btn github" id="githubLogin"><i class="fab fa-github"></i> GitHub</button>
<button class="close-btn" id="closeModal">Fermer</button>
</div>
</div>

<section id="comments">

  <h2>Avis clients</h2>

  <form id="comment-form">
    <input type="text" id="username" placeholder="Votre nom" required>

    <div class="stars">
      <span data-value="1">â­</span>
      <span data-value="2">â­</span>
      <span data-value="3">â­</span>
      <span data-value="4">â­</span>
      <span data-value="5">â­</span>
    </div>

    <input type="hidden" id="rating">

    <textarea id="comment" placeholder="Votre commentaire" required></textarea>

    <button type="submit">Envoyer</button>
  </form>

  <p>Moyenne : <span id="avg-rating">0</span> â­  
     (<span id="rating-count">0</span> avis)</p>

  <div id="comments-list"></div>

  <div style="text-align:center;margin-top:30px">
  <button id="loadMoreComments" class="btn btn-outline">
    Voir plus
  </button>
</div>
</section>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  FacebookAuthProvider,
  GithubAuthProvider,
  signInWithPopup,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  getDocs,
  collection,
  addDoc,
  deleteDoc,
  query,
  orderBy,
  onSnapshot,
  limit,
  startAfter,
  serverTimestamp,
  increment
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

let isAdmin = false;

/* ğŸ”‘ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBdo7NO1PnAa90PhEhuzpllkB1ESGZu3J8",
  authDomain: "harry-undersand.firebaseapp.com",
  projectId: "harry-undersand"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* PROVIDERS */
const googleProvider = new GoogleAuthProvider();
const facebookProvider = new FacebookAuthProvider();
const githubProvider = new GithubAuthProvider();

/* ELEMENTS */
const authGuest = document.getElementById("authGuest");
const authUser = document.getElementById("authUser");
const adminPanel = document.getElementById("adminPanel");
const usersTable = document.getElementById("usersTable");
const adminVisits = document.getElementById("adminVisits");

const authModal = document.getElementById("authModal");

const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");
const closeModal = document.getElementById("closeModal");
const googleLogin = document.getElementById("googleLogin");
const facebookLogin = document.getElementById("facebookLogin");
const githubLogin = document.getElementById("githubLogin");
const logoutBtn = document.getElementById("logoutBtn");
const welcomeText = document.getElementById("welcomeText");
const userPhoto = document.getElementById("userPhoto");

/* BOUTONS */
loginBtn.onclick = () => authModal.style.display = "flex";
registerBtn.onclick = () => authModal.style.display = "flex";
closeModal.onclick = () => authModal.style.display = "none";

googleLogin.onclick = () => signInWithPopup(auth, googleProvider);
facebookLogin.onclick = () => signInWithPopup(auth, facebookProvider);
githubLogin.onclick = () => signInWithPopup(auth, githubProvider);
logoutBtn.onclick = () => signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth, async user => {

  if (!user) {
    authGuest.style.display = "flex";
    authUser.style.display = "none";
    adminPanel.style.display = "none";
    return;
  }

  authGuest.style.display = "none";
  authUser.style.display = "flex";
  welcomeText.textContent = "Bienvenue " + user.displayName;
  userPhoto.src = user.photoURL;

  const userRef = doc(db, "users", user.uid);
  let snap = await getDoc(userRef);

  /* CRÃ‰ATION UTILISATEUR */
  if (!snap.exists()) {
    await setDoc(userRef, {
      name: user.displayName,
      email: user.email,
      role: "user",
      blocked: false,
      createdAt: serverTimestamp()
    });
    snap = await getDoc(userRef);
  }

  const data = snap.data();

  /* BLOCAGE */
  if (data.blocked) {
    alert("â›” Compte bloquÃ©");
    await signOut(auth);
    return;
  }

  /* ADMIN */
 if (data.role === "admin") {
  isAdmin = true;
  adminPanel.style.display = "block";
  loadUsers();
  loadStats();
} else {
  isAdmin = false;
  adminPanel.style.display = "none";
}
});

/* ğŸ“Š STATS */
async function loadStats() {
  const ref = doc(db, "stats", "global");
  const snap = await getDoc(ref);
  adminVisits.textContent = snap.data()?.visits || 0;
}

/* ğŸ‘¥ UTILISATEURS */
async function loadUsers() {
  usersTable.innerHTML = "";
  const snap = await getDocs(collection(db, "users"));

  snap.forEach(d => {
    const u = d.data();
    usersTable.innerHTML += `
      <tr>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>${u.blocked ? "â›”" : "âœ…"}</td>
        <td>
          <button onclick="toggleBlock('${d.id}', ${u.blocked})">
            ${u.blocked ? "DÃ©bloquer" : "Bloquer"}
          </button>
        </td>
      </tr>
    `;
  });
}

/* ğŸ“Š VISITES */
function todayKey() {
  const d = new Date();
  return d.toISOString().slice(0, 10); // ex: 2026-02-04
}

async function registerVisit() {
  const globalRef = doc(db, "stats", "global");
  const dailyRef = doc(db, "stats_daily", todayKey());

  await setDoc(globalRef, { visits: increment(1) }, { merge: true });
  await setDoc(dailyRef, { count: increment(1) }, { merge: true });
}

async function loadTodayVisits() {
  const ref = doc(db, "stats_daily", todayKey());
  const snap = await getDoc(ref);

  const value = snap.exists() ? snap.data().count || 0 : 0;

  const el = document.getElementById("todayVisits");
  if (el) el.textContent = value;
}

const today = todayKey();
const visitKey = "visited_" + today;

if (!localStorage.getItem(visitKey)) {
  localStorage.setItem(visitKey, "true");
  registerVisit();
}

loadTodayVisits();

/* ACTION ADMIN */
window.toggleBlock = async (uid, blocked) => {
  await setDoc(doc(db, "users", uid), { blocked: !blocked }, { merge: true });
  loadUsers();
};

/* â­ COMMENTAIRES & Ã‰TOILES */
const commentForm = document.getElementById("comment-form");
const commentsList = document.getElementById("comments-list");
const avgRating = document.getElementById("avg-rating");
const ratingCount = document.getElementById("rating-count");
const ratingInput = document.getElementById("rating");
const usernameInput = document.getElementById("username");
const commentInput = document.getElementById("comment");
const loadMoreBtn = document.getElementById("loadMoreComments");

let commentsLimit = 10;
let lastVisible = null;
let selectedRating = 0;

/* Gestion Ã©toiles */
document.querySelectorAll(".stars span").forEach(star => {
  star.onclick = () => {
    selectedRating = Number(star.dataset.value);
    ratingInput.value = selectedRating;
    document.querySelectorAll(".stars span").forEach(s =>
      s.classList.toggle("active", s.dataset.value <= selectedRating)
    );
  };
});

/* Envoi commentaire */
commentForm.addEventListener("submit", async e => {
  e.preventDefault();

  if (!selectedRating) {
    alert("Choisis une note â­");
    return;
  }

  await addDoc(collection(db, "comments"), {
    name: usernameInput.value,
    comment: commentInput.value,
    rating: selectedRating,
    createdAt: serverTimestamp()
  });

  commentForm.reset();
  selectedRating = 0;
  document.querySelectorAll(".stars span").forEach(s => s.classList.remove("active"));
});

/* Lecture commentaires en temps rÃ©el */
function loadComments() {
  const q = query(
    collection(db, "comments"),
    orderBy("createdAt", "desc"),
    limit(commentsLimit)
  );

  onSnapshot(q, snap => {
    commentsList.innerHTML = "";
    let total = 0;

    snap.forEach(d => {
      const c = d.data();
      total += c.rating;

      const date = c.createdAt?.toDate();
      const formattedDate = date
        ? date.toLocaleDateString("fr-FR") + " Ã  " +
          date.toLocaleTimeString("fr-FR", {
            hour: "2-digit",
            minute: "2-digit"
          })
        : "Date inconnue";

      commentsList.innerHTML += `
        <div class="comment-card">
          <h4>${c.name}</h4>
          <div class="stars-display">${"â­".repeat(c.rating)}</div>
          <p>${c.comment}</p>
          <small class="comment-date">ğŸ•’ ${formattedDate}</small>
          ${isAdmin ? `<button class="delete-comment" data-id="${d.id}">Supprimer</button>` : ""}
        </div>
      `;
    });

    ratingCount.textContent = snap.size;
    avgRating.textContent = snap.size
      ? (total / snap.size).toFixed(1)
      : "0.0";

    if (snap.size < commentsLimit) {
      loadMoreBtn.style.display = "none";
    } else {
      loadMoreBtn.style.display = "inline-block";
    }
  });
}

loadMoreBtn.addEventListener("click", () => {
  commentsLimit += 10;
  loadComments();
});

loadComments();

document.addEventListener("click", async e => {
  if (!e.target.classList.contains("delete-comment")) return;

  if (!confirm("Supprimer ce commentaire ?")) return;

  const id = e.target.dataset.id;
  await deleteDoc(doc(db, "comments", id));
});

const drawerLinks = document.querySelector(".drawer-links");

function updateDrawerShadow(){
  if(drawerLinks.scrollHeight > drawerLinks.clientHeight){
    drawerLinks.classList.add("can-scroll");
  } else {
    drawerLinks.classList.remove("can-scroll");
  }
}

drawerLinks.addEventListener("scroll", updateDrawerShadow);
window.addEventListener("resize", updateDrawerShadow);

updateDrawerShadow();

/* âœ¨ ANIMATION AU SCROLL */
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add("show");
    }
  });
}, { threshold: 0.2 });

document.querySelectorAll(".service-card").forEach(card => {
  observer.observe(card);
});

window.openDrawer = function(){
  document.querySelector(".drawer").classList.add("open");
  document.querySelector(".drawer-overlay").classList.add("show")
  document.body.style.overflow = "hidden";
};

window.closeDrawer = function(){
  document.querySelector(".drawer").classList.remove("open");
  document.querySelector(".drawer-overlay").classList.remove("show");
  document.body.style.overflow = "";
};

document.querySelectorAll(".drawer-links a").forEach(link=>{
  link.addEventListener("click", ()=>{
    closeDrawer();
  });
});

const searchInput = document.getElementById("drawerSearch");
const drawerItems = document.querySelectorAll(".drawer-links a");

function highlight(text, query){
  if(!query) return text;
  const regex = new RegExp(`(${query})`, "gi");
  return text.replace(regex, "<mark>$1</mark>");
}

searchInput.addEventListener("input", ()=>{
  const value = searchInput.value.toLowerCase();

  drawerItems.forEach(item=>{
    if(!item.dataset.label){
      item.dataset.label = item.textContent.trim();
    }

    const label = item.dataset.label;
    const match = label.toLowerCase().includes(value);

    item.style.display = match ? "flex" : "none";
    item.innerHTML = highlight(label, value);
  });
});
</script>

<script src="https://cdn.botpress.cloud/webchat/v3.5/inject.js" defer></script>
<script src="https://files.bpcontent.cloud/2025/12/10/23/20251210230142-FSLKPSBI.js" defer></script>

<footer style="text-align:center;padding:40px;color:#6b7280">
Â© 2026 â€” Amateur De Fantaisie
</footer>

</body>
</html>
