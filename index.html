<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harry Undersand ‚Äî D√©veloppeur & Architecte IA</title>

<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚õ©Ô∏è</text></svg>">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0b141a;
--card:#111b21;
--border:rgba(139,92,246,.35);
--violet:#8b5cf6;
--violet-dark:#7c3aed;
--text:#e9edef;
--muted:#8696a0;
}
body{
font-family:Inter,Arial,sans-serif;
background:var(--bg);
color:var(--text);
}
header{
position:fixed;
top:0;width:100%;
z-index:1000;
background:rgba(11,20,26,.9);
backdrop-filter:blur(16px);
border-bottom:1px solid var(--border);
}
.navbar{
max-width:1200px;
margin:auto;
padding:16px 24px;
display:flex;
justify-content:space-between;
align-items:center;
}
.logo{color:var(--violet);font-weight:800;text-decoration:none}
.nav-links{display:flex;gap:18px}
.nav-links a{color:var(--muted);text-decoration:none}
.nav-links a:hover{color:var(--violet)}
.burger{display:none;font-size:22px;cursor:pointer}

.container{max-width:1200px;margin:auto;padding:20px}
.hero{padding-top:160px;text-align:center}
.hero h1{font-size:3rem}
.hero span{color:var(--violet)}
.hero p{margin:20px auto;max-width:780px;color:var(--muted)}
.btn{padding:12px 22px;border-radius:30px;border:none;cursor:pointer;font-weight:600}
.btn-primary{background:linear-gradient(135deg,var(--violet),var(--violet-dark));color:#fff}
.btn-outline{background:none;border:1px solid var(--border);color:#fff}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:28px;margin-top:40px}
.card{
background:var(--card);
border:1px solid var(--border);
border-radius:20px;
padding:26px;
transition:.3s;
}
.card:hover{transform:translateY(-6px);box-shadow:0 0 30px rgba(139,92,246,.35)}

.auth-actions{display:flex;gap:10px;align-items:center}
.auth-actions img{width:32px;height:32px;border-radius:50%}

.modal-bg{
position:fixed;inset:0;
background:rgba(0,0,0,.65);
display:none;
align-items:center;
justify-content:center;
z-index:2000
}
.modal{
background:var(--card);
border:1px solid var(--border);
padding:30px;
border-radius:20px;
max-width:420px;width:100%
}
.auth-btn{
width:100%;
padding:14px;
margin-top:12px;
border-radius:12px;
border:none;
cursor:pointer;
font-weight:600;
display:flex;
align-items:center;
justify-content:center;
gap:10px
}
.auth-btn.google{background:#fff;color:#000}
.auth-btn.facebook{background:#1877f2;color:#fff}
.auth-btn.github{background:#0f172a;color:#fff}
.close-btn{margin-top:16px;background:none;border:none;color:#94a3b8;cursor:pointer}

@media(max-width:900px){
.nav-links{display:none;flex-direction:column;background:#0b141a;position:absolute;top:70px;left:0;width:100%;padding:20px}
.nav-links.show{display:flex}
.burger{display:block}
}

.stars-display{
  margin:6px 0 10px;
  color:#facc15;
}

/* =========================
   ‚≠ê AVIS & COMMENTAIRES
========================= */

#comments{
max-width:900px;
margin:80px auto;
padding:40px;
background:linear-gradient(180deg,#0f172a,#020617);
border:1px solid var(--border);
border-radius:26px;
box-shadow:0 0 60px rgba(139,92,246,.25);
}

#comments h2{
text-align:center;
font-size:2.2rem;
margin-bottom:25px;
background:linear-gradient(135deg,var(--violet),#a78bfa);
-webkit-background-clip:text;
color:transparent;
}

/* FORM */
#comment-form{
display:flex;
flex-direction:column;
gap:16px;
background:rgba(255,255,255,.02);
padding:30px;
border-radius:20px;
border:1px solid rgba(255,255,255,.06);
}

#comment-form input,
#comment-form textarea{
background:#020617;
border:1px solid rgba(255,255,255,.08);
border-radius:14px;
padding:14px 16px;
color:#fff;
font-size:15px;
outline:none;
}

#comment-form textarea{
min-height:120px;
resize:none;
}

#comment-form input:focus,
#comment-form textarea:focus{
border-color:var(--violet);
box-shadow:0 0 0 2px rgba(139,92,246,.35);
}

/* ‚≠ê √âTOILES */
.stars{
display:flex;
justify-content:center;
gap:10px;
font-size:32px;
cursor:pointer;
}

.stars span{
filter:grayscale(1);
opacity:.4;
transition:.25s ease;
}

.stars span:hover,
.stars span.active{
filter:none;
opacity:1;
transform:scale(1.25);
text-shadow:0 0 14px rgba(250,204,21,.7);
}

/* BOUTON */
#comment-form button{
margin-top:10px;
align-self:center;
padding:14px 34px;
border-radius:40px;
border:none;
font-weight:700;
font-size:15px;
cursor:pointer;
color:white;
background:linear-gradient(135deg,var(--violet),var(--violet-dark));
box-shadow:0 0 30px rgba(139,92,246,.45);
transition:.3s;
}

#comment-form button:hover{
transform:translateY(-2px);
box-shadow:0 0 50px rgba(139,92,246,.65);
}

/* üìä STATS */
#comments > p{
text-align:center;
margin:25px 0 35px;
font-size:1.1rem;
color:#c4b5fd;
}

/* LISTE COMMENTAIRES */
#comments-list{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:22px;
}

/* CARTE COMMENTAIRE */
.comment-card{
background:rgba(255,255,255,.03);
border:1px solid rgba(255,255,255,.08);
border-radius:20px;
padding:22px;
transition:.3s;
position:relative;
overflow:hidden;
}

.comment-card::before{
content:"";
position:absolute;
inset:0;
background:linear-gradient(120deg,transparent,rgba(139,92,246,.18),transparent);
opacity:0;
transition:.4s;
}

.comment-card:hover::before{
opacity:1;
}

.comment-card:hover{
transform:translateY(-6px);
box-shadow:0 0 40px rgba(139,92,246,.35);
}

.comment-card h4{
margin-bottom:6px;
color:#a78bfa;
}

.comment-card p{
color:#e5e7eb;
font-size:14px;
line-height:1.6;
}

.comment-card .stars-display{
margin:6px 0 10px;
color:#facc15;
}

.comment-date{
display:block;
margin-top:10px;
font-size:12px;
color:#9ca3af;
text-align:right;
}

.delete-comment{
margin-top:10px;
padding:6px 14px;
border:none;
border-radius:10px;
font-size:12px;
cursor:pointer;
background:#dc2626;
color:white;
}
.delete-comment:hover{
background:#b91c1c;
}

@media (max-width: 600px) {

  .hero h1 {
    font-size: 2rem;
  }

  .hero p {
    font-size: 1rem;
    padding: 0 10px;
  }

  .navbar {
    padding: 14px;
  }

  .auth-actions {
    flex-direction: column;
    gap: 6px;
  }

  #comments {
    margin: 40px 12px;
    padding: 24px 16px;
  }

  #comment-form {
    padding: 20px;
  }

  .stars {
    font-size: 26px;
  }

  .comment-card {
    padding: 18px;
  }

  .modal {
    margin: 0 12px;
  }
}
</style>
</head>

<body>

<header>
<section class="container" id="adminPanel" style="display:none">
  <div class="card">
    <h2>üëë Administration</h2>

    <p>üìä Visites : <b><span id="adminVisits">0</span></b></p>

    <h3>üë• Utilisateurs</h3>
    <table class="users-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>R√¥le</th>
          <th>Statut</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="usersTable"></tbody>
    </table>
  </div>
</section>

<div class="navbar">
<a class="logo" href="/">ÂΩ° ‚õ©Ô∏è ÂΩ°</a>
<div class="burger" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
<nav class="nav-links" id="menu">
<a href="services.html">Services</a>
<a href="chatbot.html">Chatbots</a>
<a href="streaming.html">Streaming</a>
<a href="hosting.html">H√©bergement</a>
<a href="premium.html">Premium</a>
<a href="commande.html">Commande</a>
<a href="contact.html">Contact</a>
</nav>
<div class="auth-actions" id="authGuest">
<button class="btn btn-outline" id="loginBtn">Connexion</button>
<button class="btn btn-primary" id="registerBtn">Inscription</button>
</div>
<div class="auth-actions" id="authUser" style="display:none">
<span id="welcomeText"></span>
<img id="userPhoto">
<button class="btn btn-outline" id="logoutBtn">D√©connexion</button>
</div>
</div>
</header>

<section class="hero">
<h1>Harry Undersand<br><span>D√©veloppeur & Architecte IA</span></h1>
<p>Chatbots IA, Streaming Premium, H√©bergement Cloud et automatisation digitale.</p>
</section>

<section class="container" style="text-align:center;margin-top:40px">
  <p style="color:#c4b5fd;font-size:1.1rem">
    üìÖ Aujourd‚Äôhui : <b><span id="todayVisits">0</span></b>
  </p>
</section>

<!-- MODALE AUTH -->
<div class="modal-bg" id="authModal">
<div class="modal">
<h2>Connexion</h2>
<p>Choisis un moyen pour continuer</p>
<button class="auth-btn google" id="googleLogin"><i class="fab fa-google"></i> Google</button>
<button class="auth-btn facebook" id="facebookLogin"><i class="fab fa-facebook"></i> Facebook</button>
<button class="auth-btn github" id="githubLogin"><i class="fab fa-github"></i> GitHub</button>
<button class="close-btn" id="closeModal">Fermer</button>
</div>
</div>

<section id="comments">

  <h2>Avis clients</h2>

  <form id="comment-form">
    <input type="text" id="username" placeholder="Votre nom" required>

    <div class="stars">
      <span data-value="1">‚≠ê</span>
      <span data-value="2">‚≠ê</span>
      <span data-value="3">‚≠ê</span>
      <span data-value="4">‚≠ê</span>
      <span data-value="5">‚≠ê</span>
    </div>

    <input type="hidden" id="rating">

    <textarea id="comment" placeholder="Votre commentaire" required></textarea>

    <button type="submit">Envoyer</button>
  </form>

  <p>Moyenne : <span id="avg-rating">0</span> ‚≠ê  
     (<span id="rating-count">0</span> avis)</p>

  <div id="comments-list"></div>

  <div style="text-align:center;margin-top:30px">
  <button id="loadMoreComments" class="btn btn-outline">
    Voir plus
  </button>
</div>
</section>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth,
  GoogleAuthProvider,
  FacebookAuthProvider,
  GithubAuthProvider,
  signInWithPopup,
  signOut,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  getDocs,
  collection,
  addDoc,
  deleteDoc,
  query,
  orderBy,
  onSnapshot,
  limit,
  startAfter,
  serverTimestamp,
  increment
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

let isAdmin = false;

window.toggleMenu = () => {
  document.getElementById("menu").classList.toggle("show");
};

/* üîë FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBdo7NO1PnAa90PhEhuzpllkB1ESGZu3J8",
  authDomain: "harry-undersand.firebaseapp.com",
  projectId: "harry-undersand"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* PROVIDERS */
const googleProvider = new GoogleAuthProvider();
const facebookProvider = new FacebookAuthProvider();
const githubProvider = new GithubAuthProvider();

/* ELEMENTS */
const authGuest = document.getElementById("authGuest");
const authUser = document.getElementById("authUser");
const adminPanel = document.getElementById("adminPanel");
const usersTable = document.getElementById("usersTable");
const adminVisits = document.getElementById("adminVisits");

const authModal = document.getElementById("authModal");

const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");
const closeModal = document.getElementById("closeModal");
const googleLogin = document.getElementById("googleLogin");
const facebookLogin = document.getElementById("facebookLogin");
const githubLogin = document.getElementById("githubLogin");
const logoutBtn = document.getElementById("logoutBtn");
const welcomeText = document.getElementById("welcomeText");
const userPhoto = document.getElementById("userPhoto");

/* BOUTONS */
loginBtn.onclick = () => authModal.style.display = "flex";
registerBtn.onclick = () => authModal.style.display = "flex";
closeModal.onclick = () => authModal.style.display = "none";

googleLogin.onclick = () => signInWithPopup(auth, googleProvider);
facebookLogin.onclick = () => signInWithPopup(auth, facebookProvider);
githubLogin.onclick = () => signInWithPopup(auth, githubProvider);
logoutBtn.onclick = () => signOut(auth);

/* AUTH STATE */
onAuthStateChanged(auth, async user => {

  if (!user) {
    authGuest.style.display = "flex";
    authUser.style.display = "none";
    adminPanel.style.display = "none";
    return;
  }

  authGuest.style.display = "none";
  authUser.style.display = "flex";
  welcomeText.textContent = "Bienvenue " + user.displayName;
  userPhoto.src = user.photoURL;

  const userRef = doc(db, "users", user.uid);
  let snap = await getDoc(userRef);

  /* CR√âATION UTILISATEUR */
  if (!snap.exists()) {
    await setDoc(userRef, {
      name: user.displayName,
      email: user.email,
      role: "user",
      blocked: false,
      createdAt: serverTimestamp()
    });
    snap = await getDoc(userRef);
  }

  const data = snap.data();

  /* BLOCAGE */
  if (data.blocked) {
    alert("‚õî Compte bloqu√©");
    await signOut(auth);
    return;
  }

  /* ADMIN */
 if (data.role === "admin") {
  isAdmin = true;
  adminPanel.style.display = "block";
  loadUsers();
  loadStats();
} else {
  isAdmin = false;
  adminPanel.style.display = "none";
}
});

/* üìä STATS */
async function loadStats() {
  const ref = doc(db, "stats", "global");
  const snap = await getDoc(ref);
  adminVisits.textContent = snap.data()?.visits || 0;
}

/* üë• UTILISATEURS */
async function loadUsers() {
  usersTable.innerHTML = "";
  const snap = await getDocs(collection(db, "users"));

  snap.forEach(d => {
    const u = d.data();
    usersTable.innerHTML += `
      <tr>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>${u.blocked ? "‚õî" : "‚úÖ"}</td>
        <td>
          <button onclick="toggleBlock('${d.id}', ${u.blocked})">
            ${u.blocked ? "D√©bloquer" : "Bloquer"}
          </button>
        </td>
      </tr>
    `;
  });
}

/* üìä VISITES */
function todayKey() {
  const d = new Date();
  return d.toISOString().slice(0, 10); // ex: 2026-02-04
}

async function registerVisit() {
  const globalRef = doc(db, "stats", "global");
  const dailyRef = doc(db, "stats_daily", todayKey());

  await setDoc(globalRef, { visits: increment(1) }, { merge: true });
  await setDoc(dailyRef, { count: increment(1) }, { merge: true });
}

async function loadTodayVisits() {
  const ref = doc(db, "stats_daily", todayKey());
  const snap = await getDoc(ref);

  const value = snap.exists() ? snap.data().count || 0 : 0;

  const el = document.getElementById("todayVisits");
  if (el) el.textContent = value;
}

if (!sessionStorage.getItem("visited")) {
  sessionStorage.setItem("visited", "true");
  registerVisit();
}

loadTodayVisits();

/* ACTION ADMIN */
window.toggleBlock = async (uid, blocked) => {
  await setDoc(doc(db, "users", uid), { blocked: !blocked }, { merge: true });
  loadUsers();
};

/* ‚≠ê COMMENTAIRES & √âTOILES */
const commentForm = document.getElementById("comment-form");
const commentsList = document.getElementById("comments-list");
const avgRating = document.getElementById("avg-rating");
const ratingCount = document.getElementById("rating-count");
const ratingInput = document.getElementById("rating");
const usernameInput = document.getElementById("username");
const commentInput = document.getElementById("comment");
const loadMoreBtn = document.getElementById("loadMoreComments");

let commentsLimit = 10;
let lastVisible = null;
let selectedRating = 0;

/* Gestion √©toiles */
document.querySelectorAll(".stars span").forEach(star => {
  star.onclick = () => {
    selectedRating = Number(star.dataset.value);
    ratingInput.value = selectedRating;
    document.querySelectorAll(".stars span").forEach(s =>
      s.classList.toggle("active", s.dataset.value <= selectedRating)
    );
  };
});

/* Envoi commentaire */
commentForm.addEventListener("submit", async e => {
  e.preventDefault();

  if (!selectedRating) {
    alert("Choisis une note ‚≠ê");
    return;
  }

  await addDoc(collection(db, "comments"), {
    name: usernameInput.value,
    comment: commentInput.value,
    rating: selectedRating,
    createdAt: serverTimestamp()
  });

  commentForm.reset();
  selectedRating = 0;
  document.querySelectorAll(".stars span").forEach(s => s.classList.remove("active"));
});

/* Lecture commentaires en temps r√©el */
function loadComments() {
  const q = query(
    collection(db, "comments"),
    orderBy("createdAt", "desc"),
    limit(commentsLimit)
  );

  onSnapshot(q, snap => {
    commentsList.innerHTML = "";
    let total = 0;

    snap.forEach(d => {
      const c = d.data();
      total += c.rating;

      const date = c.createdAt?.toDate();
      const formattedDate = date
        ? date.toLocaleDateString("fr-FR") + " √† " +
          date.toLocaleTimeString("fr-FR", {
            hour: "2-digit",
            minute: "2-digit"
          })
        : "Date inconnue";

      commentsList.innerHTML += `
        <div class="comment-card">
          <h4>${c.name}</h4>
          <div class="stars-display">${"‚≠ê".repeat(c.rating)}</div>
          <p>${c.comment}</p>
          <small class="comment-date">üïí ${formattedDate}</small>
          ${isAdmin ? `<button class="delete-comment" data-id="${d.id}">Supprimer</button>` : ""}
        </div>
      `;
    });

    ratingCount.textContent = snap.size;
    avgRating.textContent = snap.size
      ? (total / snap.size).toFixed(1)
      : "0.0";

    if (snap.size < commentsLimit) {
      loadMoreBtn.style.display = "none";
    } else {
      loadMoreBtn.style.display = "inline-block";
    }
  });
}

loadMoreBtn.addEventListener("click", () => {
  commentsLimit += 10;
  loadComments();
});

loadComments();

document.addEventListener("click", async e => {
  if (!e.target.classList.contains("delete-comment")) return;

  if (!confirm("Supprimer ce commentaire ?")) return;

  const id = e.target.dataset.id;
  await deleteDoc(doc(db, "comments", id));
});
</script>

<footer style="text-align:center;padding:40px;color:#6b7280">
¬© 2026 ‚Äî Amateur De Fantaisie
</footer>

</body>
</html>
